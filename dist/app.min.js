var app=angular.module("app",["ui.router","angularFileUpload","app.directives","lbServices","app.services","app.views","ngMaterial","ngMap","ngStorage"]);app.config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider","$mdThemingProvider",function($stateProvider,$urlRouterProvider,$locationProvider,$httpProvider,$mdThemingProvider){$mdThemingProvider.theme("gula").primaryPalette("blue").accentPalette("cyan").warnPalette("red"),$mdThemingProvider.setDefaultTheme("gula"),$stateProvider.state("login",{url:"/login",templateUrl:"app/components/login/login.html",controller:"loginController"}).state("reg",{url:"/reg",templateUrl:"app/components/register/register.html",controller:"registerController"}).state("main",{url:"/main",templateUrl:"app/components/app/main.html",controller:"mainController",resolve:resolve}).state("menu",{url:"/menu",templateUrl:"app/components/app/products/products.html",controller:"productsController",resolve:resolve}).state("profile",{url:"/profile",templateUrl:"app/components/app/profile/general/profileGeneral.html",controller:"profileGeneralController",resolve:resolve}).state("matches",{url:"/matches",templateUrl:"app/components/app/orders/orders.html",controller:"ordersController",resolve:resolve}).state("detail",{url:"/detail/:id",templateUrl:"app/components/app/orders/detail/detail.html",controller:"detailController",resolve:resolve,cache:!1}),$urlRouterProvider.otherwise("login")}]),app.run(function($rootScope,$state){$rootScope.uploadURL="http://52.8.192.6:3000/api/Containers/profile/upload",$rootScope.bgUploadURL="http://52.8.192.6:3000/api/backgrounds/background/upload",$rootScope.imagesURL="http://52.8.192.6/images"});var resolve={isLoggedIn:function($q,RestaurantUser,$state){var defer=$q.defer();return RestaurantUser.isAuthenticated()?(defer.resolve(),!0):($state.go("login"),defer.promise)}};
app.controller("mainController",function($scope,$rootScope,$localStorage,RestaurantUser){$scope.storage=$localStorage;var init=function(){RestaurantUser.stats({},function(res){$scope.stats=res.data}),RestaurantUser.orders({id:RestaurantUser.getCurrentId(),filter:{limit:10}},function(res){$scope.lastOrders=res})};init()});
app.controller("loginController",function($scope,RestaurantUser,$state,$localStorage){$scope.user={email:"",password:""},$scope.logon=function(){$scope.badLogin=!1,RestaurantUser.login($scope.user,function(res){RestaurantUser.restaurants({id:RestaurantUser.getCurrentId()},function(restaurant){$localStorage.profile=restaurant,$state.go("main")})},function(err){$scope.badLogin=!0})}});
app.controller("registerController",function($scope,$mdDialog,$state,Progress,RestaurantUser){$scope.newUser={},$scope.register=function(){Progress.show(),RestaurantUser.create($scope.newUser,function(res){Progress.hide(),$mdDialog.show($mdDialog.alert().clickOutsideToClose(!0).title("Gulafood").textContent("Bienvenido a Gulafood, te hemos enviado un correo con las instrucciones para completar tu registro.").ok("Aceptar")),$state.go("login")},function(){Progress.hide(),$mdDialog.show($mdDialog.alert().clickOutsideToClose(!0).title("Gulafood").textContent("Ha ocurrido un error en el registro, por favor contacte a soporte").ok("Aceptar"))})}});
var app=angular.module("app.directives",[]);app.directive("isNumber",function(){return{require:"ngModel",link:function(scope){scope.$watch("wks.number",function(newValue,oldValue){var arr=String(newValue).split("");0!==arr.length&&(1!==arr.length||"-"!=arr[0]&&"."!==arr[0])&&(2===arr.length&&"-."===newValue||isNaN(newValue)&&(scope.wks.number=oldValue))})}}});
var app=angular.module("app.services",[]);app.service("Progress",function(){this.active=!1,this.title=null;var self=this;this.show=function(_title){_title&&(self.title=_title),self.active=!0},this.hide=function(){self.active=!1,self.title=""}});
app.controller("headerController",function($localStorage,$state,$scope,RestaurantUser){$scope.storage=$localStorage,$scope.openMenu=function($mdOpenMenu,ev){originatorEv=ev,$mdOpenMenu(ev)},$scope.logout=function(){RestaurantUser.logout({}),$localStorage.user=null,$localStorage.profile=null,$state.go("login")}});
app.controller("progressController",function($scope,$rootScope,Progress){$scope.progress=Progress});
app.controller("ordersController",function($scope,$localStorage,RestaurantUser){var init=function(){RestaurantUser.orders({id:RestaurantUser.getCurrentId(),filter:{include:[{relation:"restaurant"}]}},function(res){$scope.orders=res})};init()});
app.controller("detailController",function($scope,RestaurantUser,$stateParams){var init=function(){RestaurantUser.orders.findById({id:RestaurantUser.getCurrentId(),fk:$stateParams.id},function(orders){$scope.order=orders})};init()});
